name: Create PR to TypeScript
on:
  workflow_dispatch: {}

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        with:
          node-version: "15"
          cache: npm

      - run: npm ci
      - run: npm run build
      - run: npm test

      - uses: actions/checkout@v2
        with:
          repository: "microsoft/TypeScript"
          path: "TypeScript"

      - run: |
          node ./deploy/migrate.js ./TypeScript

      - uses: peter-evans/create-pull-request@v3
        with:
          path: TypeScript
          commit-message: "ðŸ¤– Update TypeScript DOM Libs"
          title: "Update TypeScript DOM Libs"
          body: "This PR was generated by @${{ github.actor }} from https://github.com/microsoft/TypeScript-DOM-lib-generator/"
          push-to-fork: typescript-bot/TypeScript
          branch: update-dom
          labels: |
            Domain: lib.d.ts
            Housekeeping
          token: ${{ secrets.TS_GITHUB_BOT_AUTH }}
